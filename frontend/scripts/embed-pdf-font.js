/**
 * Reads DejaVuSans.ttf from node_modules, copies it to src/assets/fonts/,
 * and generates src/utils/pdfFont.js with the font as base64 for jsPDF.
 * Run from frontend: node scripts/embed-pdf-font.js
 */
import fs from 'fs'
import path from 'path'
import { fileURLToPath } from 'url'

const __dirname = path.dirname(fileURLToPath(import.meta.url))
const root = path.join(__dirname, '..')
const fontSrc = path.join(root, 'node_modules', 'dejavu-fonts-ttf', 'ttf', 'DejaVuSans.ttf')
const fontsDir = path.join(root, 'src', 'assets', 'fonts')
const fontDest = path.join(fontsDir, 'DejaVuSans.ttf')
const pdfFontPath = path.join(root, 'src', 'utils', 'pdfFont.js')

if (!fs.existsSync(fontSrc)) {
  console.error('DejaVuSans.ttf not found. Run: npm install dejavu-fonts-ttf')
  process.exit(1)
}

const buffer = fs.readFileSync(fontSrc)
const base64 = buffer.toString('base64')

if (!fs.existsSync(fontsDir)) {
  fs.mkdirSync(fontsDir, { recursive: true })
}
fs.writeFileSync(fontDest, buffer)
console.log('Wrote', fontDest)

const jsContent = `// Generated by scripts/embed-pdf-font.js â€“ do not edit manually.
/** @type {string} */
export const fontBase64 = "${base64}"
`
fs.writeFileSync(pdfFontPath, jsContent)
console.log('Wrote', pdfFontPath)
